{% extends "base.html" %}
{% block title %}Experiences — India Tours{% endblock %}

{% block content %}

<style>
/* ---------- Hero Section ---------- */
.hero-section {
    background:url('{{ url_for('static', filename='images/header.jpg') }}') center/cover no-repeat;
    position: relative;
    padding: 120px 20px;
    text-align: center;
    color: #fff;
    border-radius: 0 0 20px 20px;
    overflow: hidden;
}
.hero-section::after {
    content:"";
    position:absolute;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.45);
    z-index:0;
}
.hero-content { position: relative; z-index:1; max-width:1000px; margin:auto; }
.hero-content h1 {
    font-family: 'Times New Roman', serif;
    font-size: 3em;
    margin-bottom: 6px;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
}

.hero-content p {
    font-family: 'Times New Roman', serif;
    font-size: 1.15em;
    text-shadow: 1px 1px 6px rgba(0,0,0,0.5);
    margin-bottom: 12px;
}


/* ---------- Experiences Grid ---------- */
.experiences-list {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:28px;
    padding:16px 20px 80px;
    max-width:1200px;
    margin:12px auto 0;
}
.experience-card {
    background:#21160b;;
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 8px 20px rgba(0,0,0,0.12);
    transition: transform 0.36s, box-shadow 0.36s;
    position:relative;
    display:flex;
    flex-direction:column;
    cursor:pointer;
    opacity:0;
    transform: translateY(18px);
}
.experience-card.visible { opacity:1; transform:none; transition: transform 0.5s ease, opacity 0.5s ease; }
.experience-card:hover { transform: translateY(-8px); box-shadow:0 18px 40px rgba(0,0,0,0.18); }
.experience-card img { width:100%; height:180px; object-fit:cover; transition: transform 0.5s ease; border-radius:12px 12px 0 0; }
.experience-card:hover img { transform: scale(1.06); }
.card-body {
    padding: 16px; 
    flex: 1; 
    display: flex; 
    flex-direction: column;
    font-family: 'Poppins', sans-serif;
    color: #222; /* base text color for readability */
}

.card-body h3 {
    margin: 0 0 8px; 
    font-size: 1.05rem; 
    color: #FF6F61; /* bright coral/red-orange for headings */
}

.card-body p {
    margin: 0 0 12px; 
    color: #009688; /* vibrant turquoise/teal for paragraph text */
    font-size: 0.95rem; 
    flex: 0 0 auto;
}


/* rating & details */
.rating { display:flex; align-items:center; gap:6px; margin-top:auto; font-size:0.95rem; }
.rating span.star { color:#FFD700; font-size:16px; }
.rating span.inactive { color:#ddd; }
details summary { cursor:pointer; font-weight:600; color:#0077cc; list-style:none; position:relative; padding-right:22px; }
details summary::-webkit-details-marker { display:none; }
details summary::after { content:"▼"; position:absolute; right:0; top:0; transition:transform 0.25s; }
details[open] summary::after { transform:rotate(180deg); }
details p { margin-top:8px; color:#444; font-size:0.92rem; }

/* lightbox */
#lightbox {
    display:none;
    position:fixed;
    z-index:999;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.85);
    justify-content:center;
    align-items:center;
    padding:20px;
    box-sizing:border-box;
}
#lightbox-content {
    background:#fff;
    border-radius:12px;
    max-width:800px;
    width:100%;
    max-height:90%;
    overflow-y:auto;
    padding:16px;
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
}
#lightbox img {
    max-width:100%;
    max-height:400px;
    border-radius:12px;
    margin-bottom:12px;
}
#lightbox span.close-btn {
    position:absolute;
    top:10px;
    right:15px;
    font-size:2rem;
    color:#333;
    cursor:pointer;
}
#lightbox h3 { 
    margin: 0 0 8px; 
    color: #FF6F61; /* same bright coral/red-orange as card headings */
    font-family: 'Poppins', sans-serif;
    text-align: center; 
}

#lightbox p { 
    color: #009688; /* same vibrant turquoise/teal as card paragraphs */
    font-size: 0.95rem; 
    margin-bottom: 12px; 
    font-family: 'Poppins', sans-serif;
    text-align: center; 
}


@media (max-width:720px) {
    .hero-content h1 { font-size:2rem; }
    .hero-content p { font-size:1rem; }
    .experiences-list { margin-top:12px; padding:8px; }
}

html { scroll-behavior: smooth; }
</style>

<!-- Hero Section -->
<section class="hero-section" aria-label="Hero">
    <div class="hero-content">
        <h1>{{ tour.title if tour is defined else 'Visitor Experiences' }}</h1>
        <p>{{ tour.short_desc if tour is defined else 'Real experiences shared by travelers in India.' }}</p>
    </div>
</section>

{% set exps = [] %}
{% for e in experiences %}
    {% set _ = exps.append({'exp': e, 'rating': e.rating if e.rating is defined else 5}) %}
{% endfor %}
{% set sorted_by_rating = (exps | sort(attribute='rating'))[::-1] %}

<!-- Experiences Grid -->
<section class="experiences-list">
    {% for item in sorted_by_rating %}
        {% set exp = item.exp %}
        {% set rating = item.rating %}
        <div class="experience-card" onclick="openLightbox('{{ url_for('static', filename='images/' + exp.img) }}', '{{ exp.title|e }}', '{{ exp.long_desc|e }}')">
            <img src="{{ url_for('static', filename='images/' + exp.img) }}" alt="{{ exp.title }}">
            <div class="card-body">
                <h3>{{ exp.title }}</h3>
                <p>{{ exp.short_desc }}</p>
                <div class="rating">
                    {% for i in range(1,6) %}
                        {% if i <= rating %}
                            <span class="star">★</span>
                        {% else %}
                            <span class="star inactive">★</span>
                        {% endif %}
                    {% endfor %}
                    <div style="color:#666; font-weight:600; margin-left:6px;">{{ rating }}.0</div>
                </div>
                <details style="margin-top:12px;">
                    <summary>Read More</summary>
                    <p>{{ exp.long_desc }}</p>
                </details>
            </div>
        </div>
    {% endfor %}
</section>

<!-- Lightbox -->
<div id="lightbox">
    <div id="lightbox-content">
        <span class="close-btn" onclick="closeLightbox()">&times;</span>
        <img id="lightbox-img" src="" alt="Experience Image">
        <h3 id="lightbox-title"></h3>
        <p id="lightbox-desc"></p>
    </div>
</div>

<footer>
    &copy; {{ current_year if current_year is defined else 2025 }} India Tours. All rights reserved.
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.experience-card');
    const obs = new IntersectionObserver((entries) => {
        entries.forEach(e => {
            if (e.isIntersecting) e.target.classList.add('visible');
        });
    }, { threshold: 0.08 });
    cards.forEach(c => obs.observe(c));
});

// Lightbox
function openLightbox(src, title, desc) {
    document.getElementById('lightbox-img').src = src;
    document.getElementById('lightbox-title').innerText = title;
    document.getElementById('lightbox-desc').innerText = desc;
    document.getElementById('lightbox').style.display = 'flex';
}

function closeLightbox() {
    document.getElementById('lightbox').style.display = 'none';
}
</script>
{% endblock %}
